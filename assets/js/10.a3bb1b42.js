(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{572:function(t,a,e){"use strict";e.d(a,"a",(function(){return i}));e(76),e(77),e(24),e(78),e(29),e(39),e(114);var n=e(91);function i(t,a){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=Object(n.a)(t))||a&&t&&"number"==typeof t.length){e&&(t=e);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==e.return||e.return()}finally{if(c)throw o}}}}},573:function(t,a,e){var n=e(1),i=e(4),r=e(293),o=[].slice,s=function(t){return function(a,e){var n=arguments.length>2,i=n?o.call(arguments,2):void 0;return t(n?function(){("function"==typeof a?a:Function(a)).apply(this,i)}:a,e)}};n({global:!0,bind:!0,forced:/MSIE .\./.test(r)},{setTimeout:s(i.setTimeout),setInterval:s(i.setInterval)})},574:function(t,a,e){},651:function(t,a,e){"use strict";var n=e(574);e.n(n).a},722:function(t,a,e){"use strict";e.r(a);var n=e(572),i=e(74),r=(e(170),e(168),e(177),e(178),e(173),e(29),e(39),e(69),e(79),e(299),e(292),e(24),e(573),e(539)),o=e.n(r),s={data:function(){return{activeStep:0,loading:!1,backupJson:void 0,backupStats:{nbManga:0,nbMangaToMigrate:0,nbMigratedManga:0,nbChapters:0,nbChaptersToMigrate:0,nbMigratedChapters:0},mangaAssociationDict:{},chaptersAssociationDict:{},loadingDone:0,loadingTotal:0,backupFileName:"",errorsList:[]}},methods:{resetMigrator:function(){this.$data.activeStep=0,this.$data.loading=!1,this.$data.backupJson=void 0,this.$data.backupStats={nbManga:0,nbMangaToMigrate:0,nbMigratedManga:0,nbChapters:0,nbChaptersToMigrate:0,nbMigratedChapters:0},this.$data.mangaAssociationDict={},this.$data.chaptersAssociationDict={},this.$data.loadingDone=0,this.$data.loadingTotal=0,this.$data.backupFileName="",this.errorsList=[]},getLoadingPercentage:function(){if(0===this.$data.loadingTotal)return 100;var t=Math.round(this.$data.loadingDone/this.$data.loadingTotal*100);return t>=100?100:t},formatLoadingPercentage:function(t){return 0===this.$data.loadingTotal?"no items":"".concat(t,"%")},submitBackup:function(t){var a=this;if(console.log("Backup submitted"),this.$data.loading=!0,this.$data.backupFileName=t.file.name,"application/json"!==t.file.type)return this.$message({type:"error",message:"Invalid file format"}),console.error("Migrator: Invalid file format"),this.$refs.upload.clearFiles(),void this.resetMigrator();t.file.text().then((function(t){var e="string"==typeof t?JSON.parse(t):t;if(a.$data.backup=e,1!==e.backupSchemaVersion)return a.$message({type:"error",message:"Unsuported backup schema version: ".concat(e.backupSchemaVersion)}),console.error("Migrator: unsuported backup schema version version ".concat(e.backupSchemaVersion)),a.$refs.upload.clearFiles(),void a.resetMigrator();for(var n in e.sourceMangas){var i=e.sourceMangas[n];"MangaDex"===i.sourceId&&(i.id.includes("-")||(void 0===a.$data.mangaAssociationDict[i.id]&&(a.$data.mangaAssociationDict[i.id]={manga:[],chapters:[]}),a.$data.mangaAssociationDict[i.id].manga.push(n)))}for(var r in e.chapterMarkers){var o=e.chapterMarkers[r].chapter;"MangaDex"===o.sourceId&&(o.mangaId.includes("-")||(void 0===a.$data.mangaAssociationDict[o.mangaId]&&(a.$data.mangaAssociationDict[o.mangaId]={manga:[],chapters:[]}),a.$data.mangaAssociationDict[o.mangaId].chapters.push(r)),o.id.includes("-")||(void 0===a.$data.chaptersAssociationDict[o.id]&&(a.$data.chaptersAssociationDict[o.id]={chapters:[]}),a.$data.chaptersAssociationDict[o.id].chapters.push(r)))}a.$data.backupStats={nbManga:e.sourceMangas.length,nbMangaToMigrate:Object.keys(a.$data.mangaAssociationDict).length,nbMigratedManga:0,nbChapters:e.chapterMarkers.length,nbChaptersToMigrate:Object.keys(a.$data.chaptersAssociationDict).length,nbMigratedChapters:0},a.$data.loadingTotal=a.$data.backupStats.nbMangaToMigrate+a.$data.backupStats.nbChaptersToMigrate,console.log("Found ".concat(a.$data.loadingTotal," ids to migrate")),0===a.$data.backupStats.nbMangaToMigrate&&console.log("No manga ids to convert"),0===a.$data.backupStats.nbChaptersToMigrate&&console.log("No chapters ids to convert"),a.$data.activeStep=1}))},getMangaUUIDs:function(t){var a=arguments,e=this;return Object(i.a)(regeneratorRuntime.mark((function i(){var r,s,c,d,u,l;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=a.length>1&&void 0!==a[1]?a[1]:"manga",s=t.length,c=0,d={},u=regeneratorRuntime.mark((function a(){var i,u,p,g,h;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=t.slice(c,c+500).map((function(t){return Number(t)})),l={url:"https://cors.paperback.workers.dev/corsproxy/?apiurl=https://api.mangadex.org/legacy/mapping",method:"POST",timeout:0,mimeType:"multipart/form-data",contentType:"application/json",processData:!1,data:{type:r,ids:i}},c+=500,a.next=6,o()(l,{crossDomain:!0}).then((function(t){console.log("Successful request: ".concat(r,"-").concat(c));var a,e="string"==typeof t.data?JSON.parse(t.data):t.data,i=Object(n.a)(e);try{for(i.s();!(a=i.n()).done;){var o=a.value;d[o.data.attributes.legacyId]=o.data.attributes.newId}}catch(t){i.e(t)}finally{i.f()}}),(function(t){console.error("Migrator: failed request: ".concat(r,"-").concat(c,", error:")),console.log(t),e.$data.errorsList.push({type:"errorMessage",message:"ERROR: Failed request: ".concat(r,"-").concat(c,", see logs")})}));case 6:p=20,g=1/(u=50)*500,h=0;case 10:if(!(h<u)){a.next=17;break}return a.next=13,new Promise((function(t){setTimeout(t,p)}));case 13:e.$data.loadingDone+=g;case 14:h++,a.next=10;break;case 17:if(!(c>=s)){a.next=19;break}return a.abrupt("return","break");case 19:case"end":return a.stop()}}),a)}));case 5:return i.delegateYield(u(),"t0",7);case 7:if("break"!==i.t0){i.next=10;break}return i.abrupt("break",12);case 10:i.next=5;break;case 12:return i.abrupt("return",d);case 13:case"end":return i.stop()}}),i)})))()},startMigration:function(){var t=this;return Object(i.a)(regeneratorRuntime.mark((function a(){var e,i,r,o,s,c,d,u,l,p,g,h,b,v,m,f,k,M,_,y,$,S,D,x,C;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.$data.activeStep=2,console.log("Starting migration"),e=t.$data.backup,console.log("Migrating manga ids"),a.next=6,t.getMangaUUIDs(Object.keys(t.$data.mangaAssociationDict),"manga");case 6:for(i=a.sent,r=0,o=Object.keys(t.$data.mangaAssociationDict);r<o.length;r++)if(s=o[r],c=t.$data.mangaAssociationDict[s].manga,d=t.$data.mangaAssociationDict[s].chapters,void 0!==i[s]){u=Object(n.a)(c);try{for(u.s();!(l=u.n()).done;)p=l.value,e.sourceMangas[p].id=i[s]}catch(t){u.e(t)}finally{u.f()}g=Object(n.a)(d);try{for(g.s();!(h=g.n()).done;)b=h.value,e.chapterMarkers[b].chapter.mangaId=i[s]}catch(t){g.e(t)}finally{g.f()}}else t.$data.errorsList.push({type:"infoMessage",message:"INFO: Unexisting manga id ".concat(s,", skipping")}),console.log("Migrator: unexisting manga id ".concat(s,", skipping"));return console.log("Migrating chapter ids"),a.next=11,t.getMangaUUIDs(Object.keys(t.$data.chaptersAssociationDict),"chapter");case 11:for(v=a.sent,m=0,f=Object.keys(t.$data.chaptersAssociationDict);m<f.length;m++)if(k=f[m],M=t.$data.chaptersAssociationDict[k].chapters,void 0!==v[k]){_=Object(n.a)(M);try{for(_.s();!(y=_.n()).done;)$=y.value,e.chapterMarkers[$].chapter.id=v[k]}catch(t){_.e(t)}finally{_.f()}}else t.$data.errorsList.push({type:"infoMessage",message:"INFO: Unexisting chapter id ".concat(k,", skipping")}),console.log("Migrator: unexisting chapter id ".concat(k,", skipping"));for(D in S=[],e.activeSources)"MangaDex"!==e.activeSources[D].id&&S.push(e.activeSources[D]);for(C in S.push({author:"nar1n",desc:"Extension that pulls manga from MangaDex",website:"https://github.com/nar1n",id:"MangaDex",tags:[{text:"Recommended",type:"default"},{text:"Notifications",type:"success"}],repo:"https://paperback-ios.github.io/extensions-promises",websiteBaseURL:"https://mangadex.org",version:"1.0.0",icon:"icon.png",name:"MangaDex"}),e.activeSources=S,x=!1,e.sourceRepositories)"https://paperback-ios.github.io/extensions-promises"===e.sourceRepositories[C].url&&(x=!0);x||e.sourceRepositories.push({name:"[PROMISES] Additional Sources",url:"https://paperback-ios.github.io/extensions-promises"}),t.$data.backup=e,console.log("Manga Migration finished"),t.$data.activeStep=3;case 23:case"end":return a.stop()}}),a)})))()},downloadData:function(){var t=document.createElement("a");t.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.$data.backup))),t.setAttribute("download","Md-Migrated-"+this.$data.backupFileName),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}},c=(e(651),e(38)),d=Object(c.a)(s,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("span",[e("ElSteps",{attrs:{active:t.activeStep,"align-center":"","finish-status":"wait"}},[e("ElStep",{attrs:{title:"Load backup"}}),t._v(" "),e("ElStep",{attrs:{title:"Information"}}),t._v(" "),e("ElStep",{attrs:{title:"Migration"}}),t._v(" "),e("ElStep",{attrs:{title:"Download backup"}})],1),t._v(" "),0===t.activeStep?e("div",[t._m(0),t._v(" "),e("ElUpload",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"upload",staticClass:"upload-backup",attrs:{drag:"",action:"#","http-request":t.submitBackup}},[e("i",{staticClass:"el-icon-upload"}),t._v(" "),e("div",{staticClass:"el-upload__text"},[t._v("\n\t\t\t\tDrop backup here or "),e("em",[t._v("click to upload")])]),t._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("\n\t\t\t\tUpload a Paperback "),e("code",[t._v(".json")]),t._v(" backup\n\t\t\t")])])],1):t._e(),t._v(" "),1===t.activeStep?e("div",[e("p",{staticClass:"instruction"},[t._v("Backup successfully imported")]),t._v(" "),e("p",[t._v("\n\t\t\tThe backup countains "+t._s(t.backupStats.nbManga)+" manga and\n\t\t\t"+t._s(t.backupStats.nbChapters)+" chapters.\n\t\t\t"),e("br"),t._v("\n\t\t\t"+t._s(t.backupStats.nbMangaToMigrate)+" manga and\n\t\t\t"+t._s(t.backupStats.nbChaptersToMigrate)+" chapter legacy ids need to\n\t\t\tbe migrated.\n\t\t\t"),e("br"),t._v("\n\t\t\tEstimated convertion time:\n\t\t\t"+t._s(Math.round(t.loadingTotal/500*10)/10)+" seconds.\n\t\t\t")]),t._v(" "),e("div",{staticClass:"buttonContainer"},[e("ElButton",{attrs:{type:"danger",plain:""},on:{click:t.resetMigrator}},[t._v("Cancel")]),t._v(" "),e("ElButton",{attrs:{type:"primary",plain:""},on:{click:t.startMigration}},[t._v("Start migration")])],1)]):t._e(),t._v(" "),2===t.activeStep?e("div",[e("p",{staticClass:"instruction"},[t._v("Migrating library")]),t._v(" "),e("p",[t._v("\n\t\t\tConverted\n\t\t\t"+t._s(Math.round(t.loadingDone)>t.loadingTotal?t.loadingTotal:Math.round(t.loadingDone))+"/"+t._s(t.loadingTotal)+" ids. Please wait...\n\t\t")]),t._v(" "),e("ElProgress",{attrs:{percentage:t.getLoadingPercentage(),format:t.formatLoadingPercentage}})],1):t._e(),t._v(" "),3===t.activeStep?e("div",[e("p",{staticClass:"instruction"},[t._v("Migrated library")]),t._v(" "),e("p",[t._v("\n\t\t\tSuccessful migration. Converted\n\t\t\t"+t._s(Math.round(t.loadingTotal))+" ids.\n\t\t\t"),e("br"),t._v("\n\t\t\tDownload your migrated backup.\n\t\t")]),t._v(" "),t.errorsList.length>0?e("blockquote",t._l(t.errorsList,(function(a,n){return e("p",{key:n,class:a.type},[t._v("\n\t\t\t\t"+t._s(a.message)+"\n\t\t\t")])})),0):t._e(),t._v(" "),e("div",{staticClass:"buttonContainer"},[e("ElButton",{attrs:{type:"danger",plain:""},on:{click:t.resetMigrator}},[t._v("Cancel")]),t._v(" "),e("ElButton",{attrs:{type:"primary",plain:""},on:{click:t.downloadData}},[t._v("Download Paperback backup "),e("i",{staticClass:"el-icon-download"})])],1)]):t._e()],1)}),[function(){var t=this.$createElement,a=this._self._c||t;return a("p",{staticClass:"instruction"},[this._v("\n\t\t\tProvide a Paperback "),a("code",[this._v(".json")]),this._v(" Backup\n\t\t")])}],!1,null,null,null);a.default=d.exports}}]);